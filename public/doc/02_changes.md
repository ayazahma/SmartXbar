# Changes

@subpage v4_0_7

@subpage v4_0_6

@subpage v4_0_5

@subpage v4_0_4

@subpage v4_0_3

@subpage v4_0_2

@subpage v4_0_1

@subpage v4_0_0

@subpage v3_10_0

@subpage v3_9_3

@subpage v3_9_2

@subpage v3_9_1

@subpage v3_9_0

@subpage v3_8_2

@subpage v3_8_1

@subpage v3_8_0

@subpage v3_7_12

@subpage v3_7_11

@subpage v3_7_10

@subpage v3_7_9

@subpage v3_7_8

@subpage v3_7_7

@subpage v3_7_6

@subpage v3_7_5

@subpage v3_7_4

@subpage v3_7_3

@subpage v3_7_2

@subpage v3_7_1

@subpage v3_7_0

@subpage v3_6_8

@subpage v3_6_7

@subpage v3_6_6

@subpage v3_6_5

@subpage v3_6_4

@subpage v3_6_3

@subpage v3_6_2

@subpage v3_6_1

@subpage v3_6_0

@subpage v3_5_0

@subpage v3_4_0

@subpage v3_3_1

@subpage v3_3_0

@subpage v3_2_3

@subpage v3_2_2

@subpage v3_2_1

@subpage v3_2_0

@subpage v3_1_0

@subpage v3_0_0

@subpage v2_7_1

@subpage v2_7_0

@subpage v2_6_1

@subpage v2_6_0

@subpage v2_5_0

@subpage v2_4_0

@subpage v2_3_0

@subpage v2_2_0

@subpage v2_1_0

@subpage v2_0_0

@subpage v1_7_0

@subpage v1_6_1

@subpage v1_6_0

@subpage v1_5_1

@subpage v1_5_0

@subpage v1_4_0

@subpage v1_3_0

@subpage v1_2_0

@subpage v1_1_0

@subpage v0_1_0

@page v4_0_7 4.0.7

* Add log entry for clearing the device handle and closing the ALSA pcm device.

@page v4_0_6 4.0.6

* Fix segfault when trying to connect a stopped audio source device of clock type eIasClockReceived. Connecting
a stopped audio source device is not allowed and will lead to an error now.

@page v4_0_5 4.0.5

* Fix segfault when stopping an audio source device that has active connected audio ports.

@page v4_0_4 4.0.4

* Fix segfault when probing from a disconnected port.

@page v4_0_3 4.0.3

* Increase robustness when misusing SmartXbar API:
  * Fix segfault, which could be produced by destroying a port and anyway trying to connect the destroyed port.
  * Fix segfault, which could be produced by destroying all connected ports and then stopping and starting the SmartXbar again.

@page v4_0_2 4.0.2

* Add missing include to fix compile issue with newer versions of the gcc compiler.

@page v4_0_1 4.0.1

* Fix error when trying to disconnect a previously connected source, when before a disconnect of this source from
a different invalid sink was done. In this case the disconnect of the active connection failed.
* Fix segfault when using improper period size values for the configuration of source or sink devices.

@page v4_0_0 4.0.0

* The previous version introduced a binary incompatible change, which is now reflected by the major version number 4.
* Fix error when trying to reconnect a previously connected sink, which was automatically disconnected by stopping the
connected source device.
* Added log message in the IasAudio::IasAlsaHandlerWorkerThread to see when an ALSA device does provide less than one period size
of free space (playback device) or samples (capture device).

@page v3_10_0 3.10.0

* Update SmartXbar API (Version 2.2.0):
  * add getter for being able to retrieve the whole topology from SmartXbar to display it inside FDK.
* Add @ref md_datasheet_smartXConfigParser. This is an additional library that can be used to parse an xml file
generated by the FDK tool to simplify SmartXbar topology creation.

@page v3_9_3 3.9.3

* Fix segfault when stopping an audio source device with at least one active connection.
* Fix segfault when probing from an unconnected audio source device output port.

@page v3_9_2 3.9.2

* Fix possible deadlock introduced by previous fix (see v3.9.1).
* Increase robustness by filtering outdated events from SmartXClients.

@page v3_9_1 3.9.1

* Fix segfault when stopping a derived routing zone that has a sink device of clock type IasAudio::eIasClockProvided.

@page v3_9_0 3.9.0

* Added equalizer module to the processing module library.

@page v3_8_2 3.8.2

* Rework diagnostic feature to allow direct logging to DLT.

@page v3_8_1 3.8.1

* Reduce amount of log messages 'Only x frames free space available' in routing zone context.

@page v3_8_0 3.8.0

* Add new diagnostic feature for ALSA handler/ASRC.
* Reset SRC controller when ALSA handler falls back to start-up phase.
* Set default log level to info for all contexts mentioned in @ref no_audio_analysis.

@page v3_7_12 3.7.12

* Use correct mutex when doing asynchronous flush of alsa-smartx-plugin shared memory ring buffer to avoid
race condition during access of this buffer from the real-time thread.
* Do not continue the disconnect when the input port has no owner associated with it.
* Fix DLT context name typo in @ref no_audio_analysis. Valid DLT context name is SXC and not SMC.

@page v3_7_11 3.7.11

* Fixed issue, where preparation of ASRC buffer lead to very long thread blocking
of the ASRC worker thread. This also lead to blocking of the pthread_join function
for this thread for a very long time.

@page v3_7_10 3.7.10

* Reduce the amount of logging in case a switch matrix job is locked.

@page v3_7_9 3.7.9

* Clear buffers used by ASRC in ALSA handler to avoid playing old content.

@page v3_7_8 3.7.8

* Check the period size of the pipeline during configuration to be a multiple of 4 for gcc compiler or a multiple of 8 for the Intel compiler.
* Document constraint of the pipeline configuration regarding the period size.
* Avoid floating point exception during init of the ALSA handler when the period time is 0.

@page v3_7_7 3.7.7

* Return an error from IasAudio::IasSetupHelper::deleteSinkDevice if sink device has active connections.

@page v3_7_6 3.7.6

* Add error printout in case IasAudio::IasSmartX::create() fails.
* Change the compare\_exchange method used in IasAudio::IasSmartX::create() from weak to strong, because the weak version may spuriously fail as stated in the documentation, which might have been the root cause for the method to fail and return the nullptr.
* Update the ICD documentation regarding the naming of the wave files for the probing feature.
* Change the log level for the getPortByName and getPinByName methods from error to info to avoid confusion while analyzing the log.
* Reduce the amount of log in the IasAlsaHandlerWorkerThread when a device reports a timeout.
* Improve logging by adding number of samples in conversion buffer and number of frames to transfer.

@page v3_7_5 3.7.5

* Reduce the amount of log when a sink device reports a timeout.

@page v3_7_4 3.7.4

* add reference to pins in IasIDebug interface for probing.

@page v3_7_3 3.7.3

* Fix deadlock between routing zone worker thread and ALSA handler worker thread. This deadlock could occur when an ALSA sink device was configured with eIasClockReceivedAsync, which enables the ASRC.
* Fix issue when stopping of routing zone hangs after using multiple sources and sinks with different sample rates.

@page v3_7_2 3.7.2

* Correction of included headers.

@page v3_7_1 3.7.1

* Do not allow to delete a sink device while its routing zone is active. Setup will return an error in that scenario.

@page v3_7_0 3.7.0

* Implementation of probing for audio pins, which are connected to a processing module.

@page v3_6_8 3.6.8

* Due to changed behaviour of the DSP, the DLT log from the context RZN containing "Zeroed out sink buffer" are reduced to appear app. every second. The log level was changed to info.
* The DLT log of AHD containing "invalid time diff" was set to verbose.

@page v3_6_7 3.6.7

* Do not allow operations on routing zones, or their internal configuration while it is active and running.
* Fixing segfault of mixer when setting balance, gain offset or fader.

@page v3_6_6 3.6.6

* Fix copy frame size in switch matrix when synchronous sample rate conversion from low rate to high rate with same period size is done.

@page v3_6_5 3.6.5

* Mixer ramping behaviour has changed so that now a sample correct ramping is applied.

@page v3_6_4 3.6.4

* Send the IasAudio::IasConnectionEvent::IasEventType::eIasSourceDeleted, when a source of an active connection is deleted. The event IasAudio::IasConnectionEvent::IasEventType::eIasSinkDeleted is marked as deprecated, but still left in for binary backward compatibility.
* Change the initialization sequence for audio processing modules of the core and cmd instance. The core is now initialized before the cmd instance in order to query some internal settings of the core during the initialization of the cmd instance.

@page v3_6_3 3.6.3

* Check if a routing zone is active before unlinking a port. If the routing zone is active, then unlinking is not allowed and not done.
* Before destroying a source device, it is checked if any ports of the device are currently connected. In this case the ports are first disconnected, before the device is actually destroyed.

@page v3_6_2 3.6.2

* fix scheduling of derived zones if their period multiple is greater than 1 and runner threads are disabled.

@page v3_6_1 3.6.1

* fix segfault during clean-up of SmartXbar.
* fix clean-up of testfwx. Not all instances being created by testfwx were destroyed during clean-up.
* fix race-condition in SmartXbar client management.
* fix memory corruption of shared memory in case of sample rate conversion.

@page v3_6_0 3.6.0

* add configuration option in config file to enable runner threads. They are disabled by default.
* add new chapter @ref no_audio_analysis
* restructure CMake files for source delivery

@page v3_5_0 3.5.0

* Fix segfault during unlockJobs.
* Check parameters of port before allowing to add them to sources, sinks and routing zones:
  * Routing zone input ports always have to be configured with an index of zero.
  * Source and sink ports + their number of channels are now checked to be in the range of the maximum number of channels of the source or sink device.
* fix some issues in Test Framework.
* deprecated description of how to set the initial DLT log level using the config file is removed from ICD.

@page v3_4_0 3.4.0

* Change the behavior of the routing zone in case the sink device ring buffer is full.
  The sink device ring buffer is now left in this state and the samples are just discarded.
  Additionally the new functionality of the ring buffer is used to zero out it's contents,
  which only replaces the samples with zeros.
* Added Test Framework for SmartX processing modules.
  The SmartXbar Test Framework provides the function to evaluate custom
  processing modules using WAVE files, which serve as audio sources and
  audio sinks.

@page v3_3_1 3.3.1

* Fix event evaluation in routing zone. The issue lead to the problem that multiple stop events were evaluated at the wrong time and thus caused a device being stopped, also it was not supposed to be stopped.

@page v3_3_0 3.3.0

* Update SmartXbar API (Version 2.1.0):
  * add getter to retrieve a previously generated pipeline by its name.
* increase timeout in ALSA handler while waiting for an ALSA device to become ready for io.
* fix incorrect copy operation at input of pipeline, which is relevant for stereo and multichannel streams.
* improve DLT logging.
* add hooks for SmartXbar interfaces for being able to easily inject additional functionality via LD_PRELOAD.
* fix segfault on stop of derived routing zone and base routing zone.

@page v3_2_3 3.2.3

* Fix mixer event boundary values.
* Fix datatype in documentation of volume event.

@page v3_2_2 3.2.2

* Fix concurrent access to ringbuffer during start-up when doing prefill. Concurrent access could happen from command and control thread and real-time thread.

@page v3_2_1 3.2.1

* Fix start/stop event handling for alsa-smartx-plugin. After receiving a stop event, the reception of
the next event was delayed for *period time*. This lead to undefined behavior for subsequent usage of
an alsa-smartx-plugin instance.

@page v3_2_0 3.2.0

* Bugfix for use cases when switch matrix performs synchronous sample rate conversion: correction of buffer sizes used for accesing source ringbuffer.
* Several updates to fix hw ptr issue and also some null pointer issues.

@page v3_1_0 3.1.0

* Mixer module:
  * add mixer datasheet @ref md_datasheet_mixer
  * change float to int values in command interface
* Volume/Loudness module:
  * fix initialization handling which could lead to a segmentation fault under certain conditions
  * return an error for unimplemented logarithmic volume ramp shape
* Mixer and Volume/Loudness module:
  * change the returned values and types in the events to match the ones from the command
  * add return properties for setModuleState methods and add description in ICD
* Reduce number of copy operations required in pipeline context
* fix issue of connecting a source more than once, while the second connection is still locked. In this case the first connection also was disabled.
* add probing chapter @ref probing
* reduce amount of DLT context registrations for context 'PFW'

@page v3_0_0 3.0.0

* Update SmartXbar API (Version 2.0.0):
  * support to link multiple sink devices to one single pipeline if the parameters sample rate, period size and buffer size for all sink devices are equal. The API syntax did not change, however the sequence of the method calls had to change. The method IasAudio::IasISetup::addPipeline(IasRoutingZonePtr, IasPipelinePtr) has to be called **before** pins and ports of a pipeline can be linked to a sink device. This was not required in previous releases and also implemented differently in the example application.
* fixed copy size calculation for synchronous sample rate conversion of switch matrix
* add events to mixer module
* fix clearing of buffers before processing mixer

@page v2_7_1 2.7.1

* fix deletion of source and sink devices from IasSetupHelper
* add missing implementation of static version query methods getMajor, getMinor, getPatch and getVersion
* added description about generation of module events to ICD
* Volume/Loudness module: verify that loudness filter gain == 1.0
* Mixer module: fix setting of balance and fader values

@page v2_7_0 2.7.0

* Shared memory files are now created using a specific group name. The default group name is
  **ias_audio**. This can be changed via a new configuration parameter in the file
  \c smartx_config.txt, as described in @ref shm_group "Shared memory file group name".

@page v2_6_1 2.6.1

* Routing zones now trigger the fdSignal, even if output buffer is full.
  This implements a bug fix for the issue that during the 2nd phone call the
  voice enhancement process runs in a snd_pcm_wait timeout condition.

@page v2_6_0 2.6.0

* Allow to add unregistered config options in config file
* Improve logging of switch matrix

@page v2_5_0 2.5.0

* Allow non-interleaved format for alsa-smartx-plugin.
* Fixed stop/start behavior of routing zones (restart of routing zone did not work).


@page v2_4_0 2.4.0

* Customer modules now have access to typeName and instanceName via the configuration parameters.
* The Volume/Loudness module now includes the typeName and instanceName into the event properties.
* More stringent check of the device parameter @a numPeriods.
* When an audio processing module is re-activated, its reset() method is now called in order to clear any internal state variables.
* Bug fix for probing function of sink ports.

@page v2_3_0 2.3.0

* Update SmartXbar API (Version 1.3.0):
    * Added deleter functions for sink/source devices in IasSetupHelper.
* Several bug fixes.
* Extended diagnostics for asynchronous ALSA handlers and routing zones.
* Increased timeout period for ALSA handler.

@page v2_2_0 2.2.0

* Update SmartXbar API (Version 1.2.0):
    * Additional getter functions in IasISetup.hpp and IasSetupHelper.hpp, required for the updated start-stop behavior of routing zones (see below).
* Reworked the start-stop behavior for routing zones:
    * derived routing zones are not automatically started with their base zone anymore
    * each zone has to be started explicitly instead
    * also added some methods to query all currently configured routing zones, source devices, and sink devices
    * added some methods to get a handle from the name of routing zones, source devices, and sink devices
    * fixed failing tests due to changed behavior of starting a base routing zone configured for a clock provided device
* Added check that base routing zones get an appropriate clockType.
* Fixed bug, which may appear due to a race condition during routing zone cleanup.
* Updated ICD:
    * Provide more details for starting of routing zones.
    * Convert upper-case writing to lower-case to make ICD more consistent.
    * Added section how to link audio ports.
    * Updated image with SmartXbar latency overview: The ALSA handler for the topmost routing zone has been removed.
    * Added chapter about how to achieve constant latency by configuring the period times correctly.
* Added range check for Volume/Loudness module (defect ASD100017074).
* Additional DLT LOG messages for Volume/Loudness module.
* Added synchronization for start of derived zones.
* Fixed nonblocking streaming issue for alsa_smartx_plugin.

@page v2_1_0 2.1.0

* Update SmartXbar API (Version 1.1.0):
    * IasEventProvider interface has been made public, so that customer modules can make use of it
* Fixed bug in IasISetup::addAudioPinMapping function: input pins are now appropriately inserted into internal lists
* Improved error handling if method IasISetup::initPipelineAudioChain fails while creating an audio component
* Extended check that pipeline params match with sink device params
* Corrected ICD documentation of volume loudness tuning properties

@page v2_0_0 2.0.0

* Update SmartXbar API (Version 1.0.0):
    * Extended IasISetup interface to support audio processing features
    * Extended IasIProcessing interface to support audio processing features
    * Removed IasITuning interface because tuning features are also handled via IasIProcessing
* Add audio processing feature, including audio processing framework to support custom processing modules
* Added volume/loudness module as the first module of the Intel provided plug-in library

@page v1_7_0 1.7.0

* fix race condition in switch matrix during connect
* fix capture direction of alsa-smartx-plugin in combination with ALSA handler. This is used when capturing audio samples from AVB streamhandler.
* remove switch matrix worker thread to reduce number of threads
* add multiplexing functionality to routing zones

@page v1_6_1 1.6.1

* fix race condition when starting or stopping data probing

@page v1_6_0 1.6.0

* Update SmartXbar API (Version 0.3.0):
    * added new method to IasISetup interface to get a vector of all audio ports
* fix year 2038 bug in alsa-smartx-plugin
* clean-up alsa-smartx-plugin when interrupting a disconnected playback device
* add thread naming scheme
* integrate synchronous sample rate conversion into switch matrix
* stabilize data probing

@page v1_5_1 1.5.1

* fix year 2038 bug for IPC thread.

@page v1_5_0 1.5.0

* Update SmartXbar API (Version 0.2.0):
    * added IasIDebug interface for data probing (recording, injecting of audio into and from audio ports)
* added ASRC functionality in ALSA handler

@page v1_4_0 1.4.0

* Documentation of important error messages in ICD to support debugging
* smartx\_interactive\_example supports querying of source groups

@page v1_3_0 1.3.0

* move alsa-smartx-plugin and alsa config from ias-audio-smartx to ias-audio-common
* add config to support usage of the plugin from AVB streamhandler
* improve error handling of the SmartXbar API

@page v1_2_0 1.2.0

* Added source group feature to avoid blocking of devices for same content with different channel layout.

@page v1_1_0 1.1.0

* Support for capture direction for ALSA handler and alsa-smartx-plugin

@page v0_1_0 0.1.0

* Initial release of SmartXbar API (Version 0.1.0):
    * including basic instantiation methods
    * including IasIRouting API for connecting and disconnecting audio ports
    * including IasISetup API to create and destroy audio source devices, audio sink devices, audio ports and routing zones
* supporting playback direction for ALSA handler and alsa-smartx-plugin
